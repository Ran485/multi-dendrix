

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>multi_dendrix.evaluate.network &mdash; Multi-Dendrix 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/ganalytics.js"></script>
    <link rel="top" title="Multi-Dendrix 1.0 documentation" href="../../../index.html" />
    <link rel="up" title="multi_dendrix" href="../../multi_dendrix.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: center; border-top:15px #24235a solid;">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="Multi-Dendrix Logo"/></a>
<div style="width:100%;background:#23235a;height:4px;padding:0px;"></div>
<div style="width:100%;background:#23235a;height:4px;padding:0px;margin-top:2px;"></div>
<div style="width:100%;background:#23235a;height:4px;padding:0px;margin-top:2px;"></div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../pipeline.html">pipeline</a>|&nbsp;</li>
        <li><a href="../../../contents.html">contents</a>|&nbsp;</li>
        <li><a href="../../../examples.html">examples</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../multi_dendrix.html" accesskey="U">multi_dendrix</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for multi_dendrix.evaluate.network</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>

<span class="c"># Load required modules</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">product</span>

<span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">input_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># Parse arguments</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="k">class</span> <span class="nc">Args</span><span class="p">:</span> <span class="k">pass</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">&#39;Calculates network permutation test for given collection &#39;</span>\
                  <span class="s">&#39;of gene sets on the given network.&#39;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--network_edgelist&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;PPI edgelist location.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="s">&#39;--permuted_networks_dir&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Directory of permuted networks.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-p&#39;</span><span class="p">,</span> <span class="s">&#39;--collection_file&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;File containing input collection of gene sets.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="s">&#39;--output_file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Name of output file.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--distance&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Flag average pairwise distance test.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Flag verbose mode.&#39;</span><span class="p">)</span>

    <span class="c"># If called from the command line, parse command line args.</span>
    <span class="k">if</span> <span class="n">input_list</span><span class="p">:</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">args</span>

<span class="c">###############################################################################</span>
<span class="c"># Helper functions for performing the direct interactions test</span>

<div class="viewcode-block" id="load_collection"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.load_collection.html#multi_dendrix.evaluate.network.load_collection">[docs]</a><span class="k">def</span> <span class="nf">load_collection</span><span class="p">(</span><span class="n">collection_file</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Extracts the gene sets from a collection file output by Multi-Dendrix.</span>

<span class="sd">	:type collection_file: string</span>
<span class="sd">	:param collection_file: file location of collection to be loaded.</span>

<span class="sd">	:returns: **collection** (*list*) - the gene sets (*without* weights) in the input collection file.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">collection_file</span><span class="p">)</span> <span class="p">]</span>

<span class="c"># Wrapper for NetworkX&#39;s read_edgelist function</span></div>
<span class="k">def</span> <span class="nf">load_network</span><span class="p">(</span><span class="n">network_edgelist</span><span class="p">):</span> <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_edgelist</span><span class="p">(</span><span class="n">network_edgelist</span><span class="p">)</span>

<div class="viewcode-block" id="remove_name_annotation"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.remove_name_annotation.html#multi_dendrix.evaluate.network.remove_name_annotation">[docs]</a><span class="k">def</span> <span class="nf">remove_name_annotation</span><span class="p">(</span><span class="n">genes</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Removes annotation of genes or mutation classes for CNAs.</span>
<span class="sd">	By convention, I annotated CNA mutation classes with &#39;(A)&#39; for amplification</span>
<span class="sd">	and &#39;(D)&#39; for deletion. This removes these annoations so the genes can be mapped</span>
<span class="sd">	to PPI networks. For more information on naming conventions of genes and </span>
<span class="sd">	mutation classes, see :doc:`/file_formats`.</span>

<span class="sd">	:type genes: list</span>
<span class="sd">	:param genes: gene names or IDs.</span>

<span class="sd">	:returns: **genes** (*list*) - list of genes with annotation removed.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;(A)&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;(D)&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="n">genes</span><span class="p">)</span>

<span class="c"># Wrapper for itertools combos function</span></div>
<span class="k">def</span> <span class="nf">combos</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

<span class="c"># Wrapper for itertools product function</span>
<span class="k">def</span> <span class="nf">prod</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">):</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">pairs_within</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a collection of gene sets, returns all :math:`{n \choose 2}` pairs from within EACH gene set.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">pairs</span> <span class="o">+</span> <span class="n">combos</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">collection</span><span class="p">,</span> <span class="p">[])</span>

<span class="k">def</span> <span class="nf">pairs_between</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a collection of gene sets, returns all pairs from each distinct pair of gene sets.&quot;&quot;&quot;</span>
    <span class="n">pairs_of_gsets</span> <span class="o">=</span> <span class="n">combos</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pairs</span><span class="p">,</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span> <span class="n">pairs</span> <span class="o">+</span> <span class="n">prod</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="n">pairs_of_gsets</span><span class="p">,</span> <span class="p">[])</span>

<span class="c">###############################################################################</span>
<span class="c"># Functions for performing the average pairwise distance test</span>
<div class="viewcode-block" id="avg_pair_dist_of_gene_set"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.avg_pair_dist_of_gene_set.html#multi_dendrix.evaluate.network.avg_pair_dist_of_gene_set">[docs]</a><span class="k">def</span> <span class="nf">avg_pair_dist_of_gene_set</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">gset</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Counts the number of interactions among genes in the given set.</span>

<span class="sd">	:type network: NetworkX Graph</span>
<span class="sd">	:param network: input PPI network.</span>
<span class="sd">	:type gset: list</span>
<span class="sd">	:param gset: genes to test.</span>

<span class="sd">	:returns: **avg_pair_dist** (*int*) - average pairwise distance among genes in *gset*.</span>

<span class="sd">	**See also:** :func:`eval_gene_sets_by_dist`, :func:`sum_dist`.</span>

<span class="sd">	**Note:** Used by :func:`eval_gene_sets_by_dist` when performing the *average pairwise distance test* on individual gene sets.</span>
<span class="sd">	&quot;&quot;&quot;</span>	
	<span class="n">min_dist</span> <span class="o">=</span> <span class="mf">1e100</span>
	<span class="n">gset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">gset</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">gset</span> <span class="p">)</span>
	<span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">gset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gset</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="p">]</span>
	<span class="k">return</span> <span class="nb">float</span><span class="p">(</span> <span class="n">sum_dist</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">pairs</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs</span> <span class="p">)</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="eval_gene_sets_by_dist"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.eval_gene_sets_by_dist.html#multi_dendrix.evaluate.network.eval_gene_sets_by_dist">[docs]</a><span class="k">def</span> <span class="nf">eval_gene_sets_by_dist</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Evaluate each of the *t* individual gene sets by comparing the number of interactions within a gene set in the original PPI network G to the permuted networks Hs.</span>

<span class="sd">	:type collection: list of lists</span>
<span class="sd">	:param collection: Collection of gene sets to be tested.</span>
<span class="sd">	:type G: NetworkX Graph.</span>
<span class="sd">	:param G: Original PPI network.</span>
<span class="sd">	:type Hs: list of NetworkX Graphs</span>
<span class="sd">	:param Hs: permuted versions of G.</span>

<span class="sd">	**Returns:**</span>
<span class="sd">	  A list of *t* tuples where each tuple contains:</span>
<span class="sd">	    * **gset** (*list*) - the original gene set.</span>
<span class="sd">	    * **avg_pair_dist** (*float*) - the average pairwise  genes set in the original network.</span>
<span class="sd">	    * **pval**  (*float*) - the empirical *p*-value of the gene set&#39;s test statistic (i.e. the average pairwise distance) in the permuted networks.</span>

<span class="sd">	**See also:** :func:`evaluate_collection`, :func:`eval_gene_sets_by_interactions`, :func:`avg_pair_dist_test`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">stats</span><span class="p">,</span> <span class="n">pvals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">gset</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
		<span class="n">avg_pair_dist</span> <span class="o">=</span> <span class="n">avg_pair_dist_of_gene_set</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">gset</span><span class="p">)</span>
		<span class="n">permuted_dists</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">avg_pair_dist_of_gene_set</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">gset</span><span class="p">)</span> <span class="k">for</span> <span class="n">H</span> <span class="ow">in</span> <span class="n">Hs</span> <span class="p">]</span>
		<span class="n">extreme</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">permuted_dists</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">avg_pair_dist</span><span class="p">]</span>
		<span class="n">pval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">extreme</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hs</span><span class="p">)</span> <span class="p">)</span>

		<span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">avg_pair_dist</span> <span class="p">)</span>
		<span class="n">pvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pval</span> <span class="p">)</span>

	<span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">pvals</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="sum_dist"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.sum_dist.html#multi_dendrix.evaluate.network.sum_dist">[docs]</a><span class="k">def</span> <span class="nf">sum_dist</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">pairs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Given a PPI and a list of gene pairs, returns the sum of the shortest paths between each pair.</span>
<span class="sd">	</span>
<span class="sd">	:type network: NetworkX Graph</span>
<span class="sd">	:param network: input PPI network.</span>
<span class="sd">	:type pairs: list of tuples</span>
<span class="sd">	:param pairs: pairs of genes to test.</span>

<span class="sd">	:returns: **distance** (*int*) - the sum of the distances between each gene pair.</span>

<span class="sd">	**See also:** :func:`avg_pair_dist_ratio`, :func:`dist`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span> <span class="n">dist</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">)</span> <span class="k">for</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="ow">in</span> <span class="n">pairs</span> <span class="p">]</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="dist"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.dist.html#multi_dendrix.evaluate.network.dist">[docs]</a><span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Returns the length of the shortest path between g1 and g2 in PPI. If no path exists, returns 1e100.</span>

<span class="sd">	:type network: NetworkX Graph</span>
<span class="sd">	:param network: input PPI network.</span>
<span class="sd">	:type pairs: list of tuples</span>
<span class="sd">	:param pairs: pairs of genes to test.</span>

<span class="sd">	:returns: **distance** (*float*) - distance between the two genes on the network. If no path between the genes exists, returns 1e100.</span>

<span class="sd">	**See also:** :func:`direct_interactions_stat`, :func:`interact`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
	<span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
	<span class="k">except</span> <span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">NetworkXNoPath</span><span class="p">,</span> <span class="n">nx</span><span class="o">.</span><span class="n">NetworkXError</span><span class="p">):</span> <span class="k">return</span> <span class="mf">1e100</span>
</div>
<div class="viewcode-block" id="avg_pair_dist_ratio"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.avg_pair_dist_ratio.html#multi_dendrix.evaluate.network.avg_pair_dist_ratio">[docs]</a><span class="k">def</span> <span class="nf">avg_pair_dist_ratio</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Calculates the ratio of the average pairwise distance among genes within the *same* gene set and genes within *different* gene sets.</span>

<span class="sd">	:type network: NetworkX Graph.</span>
<span class="sd">	:param network: PPI network (original or permuted).</span>
<span class="sd">	:type: collection: list of lists</span>
<span class="sd">	:param collection: collection of gene sets to be tested.</span>

<span class="sd">	:returns: :math:`\\rho(\mathbf{P})` (*float*) - see definition below.</span>

<span class="sd">	**Test statistic**:</span>
<span class="sd">	  For a collection of gene sets :math:`\mathbf{P}`:</span>
<span class="sd">	    * Let :math:`\\alpha&#39;(\mathbf{P})=` average pairwise distance among pairs of genes in the *same* gene set.</span>
<span class="sd">	    * Let :math:`\\beta&#39;(\mathbf{P})=` average pairwise distance among pairs of genes in *different* gene sets.</span>
<span class="sd">	  Then the average pairwise distance ratio :math:`\\rho(\mathbf{P}) = \\alpha&#39;(\mathbf{P})-\\beta&#39;(\mathbf{P})`. *Lower* values of :math:`\\rho(\mathbf{P})` indicate stronger collections.</span>

<span class="sd">	  *Note*: if no path exists between any genes in the collection, the average pairwise distance ratio will go to infinity since the distance between two nodes in different components (or nodes not in the graph) is ill-defined.</span>

<span class="sd">	**Examples:**</span>
<span class="sd">	  A view of example input:</span>
<span class="sd">	    &gt;&gt;&gt; import networkx as nx</span>
<span class="sd">	    &gt;&gt;&gt; collection = [[&quot;G1&quot;, &quot;G2&quot;], [&quot;G3&quot;, &quot;G4&quot;]]</span>
<span class="sd">	    &gt;&gt;&gt; G = nx.Graph()</span>
<span class="sd">	    &gt;&gt;&gt; G.add_edges_from([(&quot;G1&quot;, &quot;G2&quot;), (&quot;G3&quot;, &quot;G4&quot;), (&quot;G2&quot;, &quot;G5&quot;), (&quot;G4&quot;, &quot;G5&quot;)])</span>
<span class="sd">	    &gt;&gt;&gt; nx.draw_circular(G, node_size=125, font_size=8)</span>

<span class="sd">	    .. image:: /_static/direct_interactions_test_graph.png</span>
<span class="sd">	  Calculating :math:`\\alpha&#39;(\mathbf{P})` and :math:`\\beta&#39;(\mathbf{P})`:</span>
<span class="sd">	    &gt;&gt;&gt; dist_within = sum_dist(G, pairs_within(collection))</span>
<span class="sd">	    &gt;&gt;&gt; alpha_prime  = float(dist_within) / float(len(pairs_within(collection)))</span>
<span class="sd">	    &gt;&gt;&gt; (dist_within, alpha_prime)</span>
<span class="sd">	    (2, 1.0)</span>
<span class="sd">	    &gt;&gt;&gt; dist_between = sum_dist(G, pairs_between(collection))</span>
<span class="sd">	    &gt;&gt;&gt; beta_prime  = float(dist_between) / float(len(pairs_between(collection)))</span>
<span class="sd">	    &gt;&gt;&gt; (dist_between, beta_prime)</span>
<span class="sd">	    (12, 3.0)</span>
<span class="sd">	  The direct interactions test statistic:</span>
<span class="sd">	    &gt;&gt;&gt; avg_pair_dist_ratio(G, collection)</span>
<span class="sd">	    0.33</span>

<span class="sd">	**See also:** :func:`direct_interactions_test`, :func:`eval_gene_sets_by_interactions`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c"># Ensure all genes are in the network</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">collection</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">P</span> <span class="p">]):</span>
		<span class="k">return</span> <span class="mf">1e100</span>

	<span class="c"># Enumerate pairs of genes within the same and between gene sets</span>
	<span class="n">within</span><span class="p">,</span> <span class="n">between</span> <span class="o">=</span> <span class="n">pairs_within</span><span class="p">(</span><span class="n">collection</span><span class="p">),</span> <span class="n">pairs_between</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
	<span class="n">within_dists</span>    <span class="o">=</span> <span class="p">[</span> <span class="n">dist</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">)</span> <span class="k">for</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="ow">in</span> <span class="n">within</span> <span class="p">]</span>
	<span class="n">between_dists</span>   <span class="o">=</span> <span class="p">[</span> <span class="n">dist</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">)</span> <span class="k">for</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="ow">in</span> <span class="n">between</span> <span class="p">]</span>

	<span class="c"># Ensure all genes in the same gene set are in the same component</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span> <span class="n">d</span> <span class="o">!=</span> <span class="mf">1e100</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">within_dists</span> <span class="p">]):</span>
		<span class="k">return</span> <span class="mf">1e100</span>

	<span class="c"># Check if any genes in different gene sets are not in the same component</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span> <span class="n">d</span> <span class="o">!=</span> <span class="mf">1e100</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">between_dists</span> <span class="p">]):</span>
		<span class="k">return</span> <span class="mi">0</span>

	<span class="c"># If all checks out, return the ratio</span>
	<span class="n">d_within</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">within_dists</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">within</span><span class="p">))</span>
	<span class="n">d_between</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">between_dists</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">between</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">d_within</span> <span class="o">/</span> <span class="n">d_between</span>
</div>
<div class="viewcode-block" id="avg_pair_dist_test"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.avg_pair_dist_test.html#multi_dendrix.evaluate.network.avg_pair_dist_test">[docs]</a><span class="k">def</span> <span class="nf">avg_pair_dist_test</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Performs the *average pairwise distance test* on the collection of gene sets.</span>

<span class="sd">	:type collection: list of lists</span>
<span class="sd">	:param collection: collection of gene sets to be tested.</span>
<span class="sd">	:type G: NetworkX Graph.</span>
<span class="sd">	:param G: original PPI network.</span>
<span class="sd">	:type Hs: list of NetworkX Graphs</span>
<span class="sd">	:param Hs: permuted versions of G.</span>

<span class="sd">	**Returns:**</span>
<span class="sd">	  A tuple consisting of the following:</span>
<span class="sd">	    * :math:`\\rho(\mathbf{P})` (*float*) - the average pairwise distance test statistic.</span>
<span class="sd">	    * **pval** (*float*) - the average pairwise distance test *p*-value of the given collection.</span>

<span class="sd">	**Test:**</span>

<span class="sd">	For the definition of the test statistic used by the *average pairwise distance test*, see :func:`avg_pair_dist_ratio`.</span>
<span class="sd">	The *average pairwise distance test* compares the average pairwise distance test statistic of the collection on the original and permuted PPI networks.</span>

<span class="sd">	**Note:** Genes that are not in the graph *G* or are in different connected components than the other genes are given an average pairwise distance of 1e100. These genes should be **removed** before using the *average pairwise distance test*.</span>

<span class="sd">	**Examples:**</span>
<span class="sd">	  A view of example input:</span>
<span class="sd">	    &gt;&gt;&gt; import networkx as nx</span>
<span class="sd">	    &gt;&gt;&gt; collection = [[&quot;G1&quot;, &quot;G2&quot;], [&quot;G3&quot;, &quot;G4&quot;]]</span>
<span class="sd">	    &gt;&gt;&gt; G = nx.Graph()</span>
<span class="sd">	    &gt;&gt;&gt; G.add_edges_from([(&quot;G1&quot;, &quot;G2&quot;), (&quot;G3&quot;, &quot;G4&quot;), (&quot;G2&quot;, &quot;G5&quot;), (&quot;G4&quot;, &quot;G5&quot;)])</span>
<span class="sd">	    &gt;&gt;&gt; Hs =[ nx.double_edge_swap(G.copy(), nswap=10, max_tries=1e75) for i in range(10) ]</span>
<span class="sd">	    &gt;&gt;&gt; nx.draw_circular(G, node_size=125, font_size=8)</span>
<span class="sd">	  </span>
<span class="sd">	    .. image:: /_static/direct_interactions_test_graph.png</span>
<span class="sd">	  A simple example</span>
<span class="sd">	    &gt;&gt;&gt; avg_pair_dist_test(collection, G, Hs)</span>
<span class="sd">	    (0.33, 0.10)</span>

<span class="sd">	**See also:** :func:`avg_pair_dist_ratio`, :func:`eval_gene_sets_by_dist`, :func:`direct_interactions_test`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c"># Remove name annotation for genes in the gene sets</span>
	<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">remove_name_annotation</span><span class="p">(</span><span class="n">P</span><span class="p">)))</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">collection</span> <span class="p">]</span>
	
	<span class="c"># Calculate the average pairwise distance ratio in the original network</span>
	<span class="c"># and the permuted networks. Lower ratios indicate stronger collections.</span>
	<span class="n">ratio</span>  <span class="o">=</span> <span class="n">avg_pair_dist_ratio</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>
	<span class="n">permuted_ratios</span> <span class="o">=</span> <span class="p">[</span> <span class="n">avg_pair_dist_ratio</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span> <span class="k">for</span> <span class="n">H</span> <span class="ow">in</span> <span class="n">Hs</span> <span class="p">]</span>
	<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">permuted_ratios</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">ratio</span> <span class="p">]</span> <span class="p">)</span>
	<span class="n">pval</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">count</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">Hs</span> <span class="p">)</span> <span class="p">)</span>

	<span class="k">return</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">pval</span>

<span class="c">###############################################################################</span>
<span class="c"># Functions for performing the direct interactions test</span>
</div>
<div class="viewcode-block" id="num_interactions_in_gene_set"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.num_interactions_in_gene_set.html#multi_dendrix.evaluate.network.num_interactions_in_gene_set">[docs]</a><span class="k">def</span> <span class="nf">num_interactions_in_gene_set</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">gset</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Counts the number of interactions among genes in the given set.</span>

<span class="sd">	:type network: NetworkX Graph</span>
<span class="sd">	:param network: input PPI network.</span>
<span class="sd">	:type gset: list</span>
<span class="sd">	:param gset: genes to test.</span>

<span class="sd">	:returns: **count** (*int*) - number of interactions among genes in *gset*.</span>

<span class="sd">	**See also:** :func:`eval_gene_sets_by_interactions`, :func:`count_interactions`.</span>

<span class="sd">	**Note:** Used by :func:`eval_gene_sets_by_interactions` when performing the *direct interactions test* on individual gene sets.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">best_count</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">gset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">gset</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">gset</span> <span class="p">)</span>
	<span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">gset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gset</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="p">]</span>
	<span class="k">return</span> <span class="n">count_interactions</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">pairs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="eval_gene_sets_by_interactions"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.eval_gene_sets_by_interactions.html#multi_dendrix.evaluate.network.eval_gene_sets_by_interactions">[docs]</a><span class="k">def</span> <span class="nf">eval_gene_sets_by_interactions</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Evaluate each of the *t* individual gene sets by comparing the number of interactions within a gene set in the original PPI network G to the permuted networks Hs.</span>

<span class="sd">	:type collection: list of lists</span>
<span class="sd">	:param collection: collection of gene sets to be tested.</span>
<span class="sd">	:type G: NetworkX Graph.</span>
<span class="sd">	:param G: original PPI network.</span>
<span class="sd">	:type Hs: list of NetworkX Graphs</span>
<span class="sd">	:param Hs: permuted versions of G.</span>

<span class="sd">	**Returns:**</span>
<span class="sd">	  A list of *t* tuples where each tuple contains:</span>
<span class="sd">	    * **gset** (*list*) - the original gene set.</span>
<span class="sd">	    * **num_interactions** (*int*) - the number of interactions among genes set in the original network.</span>
<span class="sd">	    * **pval**  (*float*) - the empirical *p*-value of the gene set&#39;s test statistic (i.e. the number of interactions) in the permuted networks.</span>

<span class="sd">	**See also:** :func:`evaluate_collection`, :func:`eval_gene_sets_by_dist`, :func:`direct_interactions_test`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">stats</span><span class="p">,</span> <span class="n">pvals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">gset</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
		<span class="n">num_interactions</span> <span class="o">=</span> <span class="n">num_interactions_in_gene_set</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">gset</span><span class="p">)</span>
		<span class="n">permuted_counts</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">num_interactions_in_gene_set</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">gset</span><span class="p">)</span> <span class="k">for</span> <span class="n">H</span> <span class="ow">in</span> <span class="n">Hs</span><span class="p">]</span>
		<span class="n">extreme</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">permuted_counts</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">num_interactions</span><span class="p">]</span>
		<span class="n">pval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">extreme</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hs</span><span class="p">)</span> <span class="p">)</span>

		<span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">num_interactions</span> <span class="p">)</span>
		<span class="n">pvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pval</span> <span class="p">)</span>

	<span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">pvals</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="interact"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.interact.html#multi_dendrix.evaluate.network.interact">[docs]</a><span class="k">def</span> <span class="nf">interact</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Returns true if g1 interacts with g2 in PPI.</span>

<span class="sd">	:type network: NetworkX Graph</span>
<span class="sd">	:param network: input PPI network.</span>
<span class="sd">	:type g1: string</span>
<span class="sd">	:param g1: gene in PPI.</span>
<span class="sd">	:type g2: string</span>
<span class="sd">	:param g2: gene in PPI.</span>

<span class="sd">	:returns: True if g1 interactions with g2 in the given network, False otherwise.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">g2</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">g1</span><span class="p">)</span>
	<span class="k">except</span> <span class="n">nx</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">NetworkXError</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="count_interactions"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.count_interactions.html#multi_dendrix.evaluate.network.count_interactions">[docs]</a><span class="k">def</span> <span class="nf">count_interactions</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">pairs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Given a PPI and a list of gene pairs, returns the number of genes that interact.</span>
<span class="sd">	</span>
<span class="sd">	:type network: NetworkX Graph</span>
<span class="sd">	:param network: input PPI network.</span>
<span class="sd">	:type pairs: list of tuples</span>
<span class="sd">	:param pairs: pairs of genes to test.</span>

<span class="sd">	:returns: **count** (*int*) - the number of gene pairs that interact.</span>

<span class="sd">	**See also:** :func:`direct_interactions_stat`, :func:`interact`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">interact</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">))</span> <span class="k">for</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="direct_interactions_stat"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.direct_interactions_stat.html#multi_dendrix.evaluate.network.direct_interactions_stat">[docs]</a><span class="k">def</span> <span class="nf">direct_interactions_stat</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Calculates the difference of the normalized number of interactions among genes within the *same* gene set and genes within *different* gene sets.</span>

<span class="sd">	:type network: NetworkX Graph.</span>
<span class="sd">	:param network: PPI network (original or permuted).</span>
<span class="sd">	:type: collection: list of lists</span>
<span class="sd">	:param collection: collection of gene sets to be tested.</span>

<span class="sd">	:returns: :math:`\\nu(\mathbf{P})` (*float*) - see definition below.</span>

<span class="sd">	**Test statistic**:</span>
<span class="sd">	  For a collection of gene sets :math:`\mathbf{P}`:</span>
<span class="sd">	    * Let :math:`\\alpha(\mathbf{P})=` normalized number of interactions among pairs of genes in the *same* gene set.</span>
<span class="sd">	    * Let :math:`\\beta(\mathbf{P})=` normalized number of interactions among pairs of genes in *different* gene sets.</span>
<span class="sd">	  Then the direct interactions statistic :math:`\\nu(\mathbf{P}) = \\alpha(\mathbf{P})-\\beta(\mathbf{P})`. Higher values of :math:`\\nu(\mathbf{P})` indicate stronger collections.</span>

<span class="sd">	**Examples:**</span>
<span class="sd">	  A view of example input:</span>
<span class="sd">	    &gt;&gt;&gt; import networkx as nx</span>
<span class="sd">	    &gt;&gt;&gt; collection = [[&quot;G1&quot;, &quot;G2&quot;], [&quot;G3&quot;, &quot;G4&quot;]]</span>
<span class="sd">	    &gt;&gt;&gt; G = nx.Graph()</span>
<span class="sd">	    &gt;&gt;&gt; G.add_edges_from([(&quot;G1&quot;, &quot;G2&quot;), (&quot;G3&quot;, &quot;G4&quot;), (&quot;G2&quot;, &quot;G5&quot;), (&quot;G4&quot;, &quot;G5&quot;)])</span>
<span class="sd">	    &gt;&gt;&gt; nx.draw_circular(G, node_size=125, font_size=8)</span>

<span class="sd">	    .. image:: /_static/direct_interactions_test_graph.png</span>
<span class="sd">	  Calculating :math:`\\alpha(\mathbf{P})` and :math:`\\beta(\mathbf{P})`:</span>
<span class="sd">	    &gt;&gt;&gt; int_within = count_interactions(G, pairs_within(collection))</span>
<span class="sd">	    &gt;&gt;&gt; alpha  = float(int_within) / float(len(pairs_within(collection)))</span>
<span class="sd">	    &gt;&gt;&gt; (int_within, alpha)</span>
<span class="sd">	    (2, 1.0)</span>
<span class="sd">	    &gt;&gt;&gt; int_between = count_interactions(G, pairs_between(collection))</span>
<span class="sd">	    &gt;&gt;&gt; beta  = float(int_between) / float(len(pairs_between(collection)))</span>
<span class="sd">	    &gt;&gt;&gt; (int_between, beta)</span>
<span class="sd">	    (0, 0)</span>
<span class="sd">	  The direct interactions test statistic:</span>
<span class="sd">	    &gt;&gt;&gt; direct_interactions_stat(G, collection)</span>
<span class="sd">	    1.0</span>

<span class="sd">	**See also:** :func:`direct_interactions_test`, :func:`eval_gene_sets_by_interactions`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">within_pairs</span> <span class="o">=</span> <span class="n">pairs_within</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
	<span class="n">interactions_within</span>  <span class="o">=</span> <span class="n">count_interactions</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">within_pairs</span><span class="p">)</span>
	<span class="n">alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">interactions_within</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">within_pairs</span><span class="p">))</span>

	<span class="n">between_pairs</span> <span class="o">=</span> <span class="n">pairs_between</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
	<span class="n">interactions_between</span> <span class="o">=</span> <span class="n">count_interactions</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">between_pairs</span><span class="p">)</span>
	<span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">interactions_between</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">between_pairs</span><span class="p">))</span>

	<span class="k">return</span> <span class="n">alpha</span> <span class="o">-</span> <span class="n">beta</span>
</div>
<div class="viewcode-block" id="direct_interactions_test"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.direct_interactions_test.html#multi_dendrix.evaluate.network.direct_interactions_test">[docs]</a><span class="k">def</span> <span class="nf">direct_interactions_test</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Performs the *direct interactions test* on the collection of gene sets.</span>

<span class="sd">	:type collection: list of lists</span>
<span class="sd">	:param collection: collection of gene sets to be tested.</span>
<span class="sd">	:type G: NetworkX Graph.</span>
<span class="sd">	:param G: original PPI network.</span>
<span class="sd">	:type Hs: list of NetworkX Graphs</span>
<span class="sd">	:param Hs: permuted versions of G.</span>

<span class="sd">	**Returns:**</span>
<span class="sd">	  A tuple consisting of the following:</span>
<span class="sd">	    * :math:`\\nu(\mathbf{P})` (*float*) - the direct interactions test statistic.</span>
<span class="sd">	    * **pval** (*float*) - the direct interactions test *p*-value of the given collection.</span>

<span class="sd">	**Test:**</span>

<span class="sd">	For the definition of the test statistic used by the *direct interactions test*, see :func:`direct_interactions_stat`.</span>
<span class="sd">	The *direct interactions test* compares the direct interactions test statistic of the collection on the original and permuted PPI networks.</span>

<span class="sd">	**Examples:**</span>
<span class="sd">	  A view of example input:</span>
<span class="sd">	    &gt;&gt;&gt; import networkx as nx</span>
<span class="sd">	    &gt;&gt;&gt; collection = [[&quot;G1&quot;, &quot;G2&quot;], [&quot;G3&quot;, &quot;G4&quot;]]</span>
<span class="sd">	    &gt;&gt;&gt; G = nx.Graph()</span>
<span class="sd">	    &gt;&gt;&gt; G.add_edges_from([(&quot;G1&quot;, &quot;G2&quot;), (&quot;G3&quot;, &quot;G4&quot;), (&quot;G2&quot;, &quot;G5&quot;), (&quot;G4&quot;, &quot;G5&quot;)])</span>
<span class="sd">	    &gt;&gt;&gt; Hs =[ nx.double_edge_swap(G.copy(), nswap=10, max_tries=1e75) for i in range(10) ]</span>
<span class="sd">	    &gt;&gt;&gt; nx.draw_circular(G, node_size=125, font_size=8)</span>
<span class="sd">	  </span>
<span class="sd">	    .. image:: /_static/direct_interactions_test_graph.png</span>
<span class="sd">	  A simple example</span>
<span class="sd">	    &gt;&gt;&gt; direct_interactions_test(collection, G, Hs)</span>
<span class="sd">	    (1.0, 0.1)</span>

<span class="sd">	**See also:** :func:`direct_interactions_stat`, :func:`eval_gene_sets_by_interactions`, :func:`avg_pair_dist_test`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c"># Remove name annotation for genes in the gene sets</span>
	<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">remove_name_annotation</span><span class="p">(</span><span class="n">P</span><span class="p">)))</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">collection</span> <span class="p">]</span>
	
	<span class="c"># Calculate the number of interactions statistic in the original network</span>
	<span class="c"># and the permuted networks. Higher statistics indicate stronger</span>
	<span class="c"># collections.</span>
	<span class="n">stat</span>  <span class="o">=</span> <span class="n">direct_interactions_stat</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>
	<span class="n">permuted_stats</span> <span class="o">=</span> <span class="p">[</span> <span class="n">direct_interactions_stat</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span> <span class="k">for</span> <span class="n">H</span> <span class="ow">in</span> <span class="n">Hs</span> <span class="p">]</span>
	<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">permuted_stats</span> <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="n">stat</span> <span class="p">]</span> <span class="p">)</span>
	<span class="n">pval</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">count</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">Hs</span> <span class="p">)</span> <span class="p">)</span>

	<span class="k">return</span> <span class="n">stat</span><span class="p">,</span> <span class="n">pval</span>

<span class="c">###############################################################################</span>
<span class="c"># Main functions for evaluating collections of gene sets</span>
</div>
<div class="viewcode-block" id="evaluate_collection"><a class="viewcode-back" href="../../../module_docs/network_tests/multi_dendrix.evaluate.network.evaluate_collection.html#multi_dendrix.evaluate.network.evaluate_collection">[docs]</a><span class="k">def</span> <span class="nf">evaluate_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Given a collection of gene sets, the original network, and a set of permuted networks, calculates the empirical *p*-value using the direct interactions statistic (or average pairwise distance statistic).</span>
<span class="sd">	For details on the tests performed on collections of gene sets (with examples), see :func:`direct_interactions_test` (or :func:`avg_pair_dist_test`).</span>

<span class="sd">	:type collection: list of lists</span>
<span class="sd">	:param collection: collection of gene sets to be tested.</span>
<span class="sd">	:type G: NetworkX Graph.</span>
<span class="sd">	:param G: original PPI network.</span>
<span class="sd">	:type Hs: list of NetworkX Graphs</span>
<span class="sd">	:param Hs: permuted versions of G.</span>
<span class="sd">	:type distance: bool</span>
<span class="sd">	:param distance: Flag whether to use average pairwise distance as the test statistic.</span>

<span class="sd">	**Returns:**</span>
<span class="sd">	  * **test_name** (*string*) - name of test (either &quot;Direct_Interactions_Statistic&quot; or &quot;Average_Pairwise_Distance_Ratio&quot;).</span>
<span class="sd">	  * **statistic** (*float*) - test statistic of the collection on the original network</span>
<span class="sd">	  * **pval** (float) - empirical *p*-value of the collection on the original versus permuted networks.</span>
<span class="sd">	  * **gene_set_results** (list) - evaluation of each gene set using the original and permuted networks (see :func:`eval_gene_sets_by_interactions` and :func:`eval_gene_sets_by_dist` for details).</span>

<span class="sd">	**See also:** :func:`direct_interactions_test`, :func:`avg_pair_dist_test`.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c"># Calculate test statistic and p-value</span>
	<span class="k">if</span> <span class="n">distance</span><span class="p">:</span>
		<span class="n">test_name</span> <span class="o">=</span> <span class="s">&#39;Average_Pairwise_Distance_Ratio&#39;</span>
		<span class="n">statistic</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">avg_pair_dist_test</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">)</span>
		<span class="n">gene_set_results</span> <span class="o">=</span> <span class="n">eval_gene_sets_by_dist</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">test_name</span> <span class="o">=</span> <span class="s">&#39;Direct_Interactions_Statistic&#39;</span>
		<span class="n">statistic</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">direct_interactions_test</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">)</span>
		<span class="n">gene_set_results</span> <span class="o">=</span> <span class="n">eval_gene_sets_by_interactions</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">statistic</span><span class="p">,</span> <span class="n">pval</span><span class="p">,</span> <span class="n">gene_set_results</span>
</div>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Performs the direct interactions test (or average pairwise distance test) on a the input collection of gene sets using the empirical distribution of input permuted PPI networks.&quot;&quot;&quot;</span>
	<span class="c"># Load input</span>
	<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;Loading networks...&#39;</span>
	<span class="n">collection</span> <span class="o">=</span> <span class="n">load_collection</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">collection_file</span><span class="p">)</span>
	<span class="n">G</span>         <span class="o">=</span> <span class="n">load_network</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">network_edgelist</span><span class="p">)</span>
	<span class="n">Hs</span>        <span class="o">=</span> <span class="p">[</span> <span class="n">load_network</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">permuted_networks_dir</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">fh</span><span class="p">)</span>
	              <span class="k">for</span> <span class="n">fh</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">permuted_networks_dir</span><span class="p">)</span> <span class="p">]</span>
	
	<span class="c"># Evaluate the collection</span>
	<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;Evaluating input collection...&#39;</span>
	<span class="n">results</span> <span class="o">=</span> <span class="n">evaluate_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
	<span class="n">test_name</span><span class="p">,</span> <span class="n">statistic</span><span class="p">,</span> <span class="n">pval</span><span class="p">,</span> <span class="n">gene_set_results</span> <span class="o">=</span> <span class="n">results</span>	

	<span class="c"># Output and return results</span>
	<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">output_file</span><span class="p">:</span>
		<span class="n">header</span> <span class="o">=</span> <span class="s">&#39;Testing</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">test_name</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">P-Value</span><span class="se">\n</span><span class="s">&#39;</span>
		<span class="n">output</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;Collection&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">statistic</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">pval</span><span class="p">)])</span> <span class="p">]</span>
		<span class="k">for</span> <span class="n">gene_set</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">gene_set_results</span><span class="p">:</span>
			<span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gene_set</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)])</span> <span class="p">)</span>
		<span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
	
	<span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;Collection of gene sets test&#39;</span>
		<span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">test_name</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">statistic</span>
		<span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">P-value:&#39;</span><span class="p">,</span> <span class="n">pval</span>
		<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Individual gene sets test&#39;</span>
		<span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">pval</span> <span class="ow">in</span> <span class="n">gene_set_results</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Genes:&#39;</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
			<span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Statistic:&#39;</span><span class="p">,</span> <span class="n">stat</span>
			<span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">P-value:&#39;</span><span class="p">,</span> <span class="n">pval</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

	<span class="k">return</span> <span class="n">statistic</span><span class="p">,</span> <span class="n">pval</span><span class="p">,</span> <span class="n">gene_set_results</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span> <span class="n">run</span><span class="p">(</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../pipeline.html">pipeline</a>|&nbsp;</li>
        <li><a href="../../../contents.html">contents</a>|&nbsp;</li>
        <li><a href="../../../examples.html">examples</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../multi_dendrix.html" >multi_dendrix</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Max Leiserson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>