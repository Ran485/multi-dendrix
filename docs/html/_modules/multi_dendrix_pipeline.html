

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>multi_dendrix_pipeline &mdash; Multi-Dendrix 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Multi-Dendrix 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: center; border-top:15px #24235a solid;">
<a href="../index.html"><img src="../_static/logo.png" border="0" alt="Multi-Dendrix Logo"/></a>
<div style="width:100%;background:#23235a;height:4px;padding:0px;"></div>
<div style="width:100%;background:#23235a;height:4px;padding:0px;margin-top:2px;"></div>
<div style="width:100%;background:#23235a;height:4px;padding:0px;margin-top:2px;"></div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../pipeline.html">pipeline</a>|&nbsp;</li>
        <li><a href="../contents.html">contents</a>|&nbsp;</li>
        <li><a href="../examples.html">examples</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for multi_dendrix_pipeline</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Script for running the whole Multi-Dendrix pipeline. Consists of the following</span>
<span class="sd">steps:</span>
<span class="sd">  1. Runs Multi-Dendrix </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Load required modules and add the lib to the path</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">&#39;./lib&#39;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">output_functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">input_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># Parse arguments</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="k">class</span> <span class="nc">Args</span><span class="p">:</span> <span class="k">pass</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">&#39;Runs Multi-Dendrix for a set of parameters. Evaluates the &#39;</span>\
                  <span class="s">&#39;results and outputs them as text and as a website.&#39;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

    <span class="c"># General options</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="s">&#39;--output_dir&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Name of output directory.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Flag verbose mode.&#39;</span><span class="p">)</span>

    <span class="c"># Options for Multi-Dendrix</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-k_min&#39;</span><span class="p">,</span> <span class="s">&#39;--min_gene_set_size&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Minimum gene set size.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-k_max&#39;</span><span class="p">,</span> <span class="s">&#39;--max_gene_set_size&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Maximum gene set size.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-t_min&#39;</span><span class="p">,</span> <span class="s">&#39;--min_num_gene_sets&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Minimum number of gene sets.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-t_max&#39;</span><span class="p">,</span> <span class="s">&#39;--max_num_gene_sets&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Maximum number of gene sets.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--db_name&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Name of mutation data for use in output.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="s">&#39;--mutation_matrix&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;File name for mutation data.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="s">&#39;--cutoff&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Minimum gene mutation frequency.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-p&#39;</span><span class="p">,</span> <span class="s">&#39;--patient_whitelist&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;File of patients to be included.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-bp&#39;</span><span class="p">,</span> <span class="s">&#39;--patient_blacklist&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;File of patients to be excluded.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-g&#39;</span><span class="p">,</span> <span class="s">&#39;--gene_whitelist&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;File of genes to be included.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-bg&#39;</span><span class="p">,</span> <span class="s">&#39;--gene_blacklist&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;File of genes to be excluded.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-a&#39;</span><span class="p">,</span> <span class="s">&#39;--alpha&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Parameter that changes weight function W by &#39;</span>\
                        <span class="s">&#39;weighting the penalty of coverage overlap.&#39;</span><span class="p">)</span>    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--delta&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Number of overlaps allowed per gene set.&#39;</span><span class="p">)</span>    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--lmbda&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Number of gene sets a gene can be a member of.&#39;</span><span class="p">)</span>
    
    <span class="c"># Options for core modules</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--stability_threshold&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Minimum proportion of gene sets two genes must &#39;</span>\
                             <span class="s">&#39;both be a member of to be connected in the &#39;</span>\
                             <span class="s">&#39;core modules.&#39;</span><span class="p">)</span>

    <span class="c"># Options for (sub)type analysis</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--subtypes&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Perform (sub)type analysis.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--subtype_sig_threshold&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Significance threshold for subtype association &#39;</span>\
                             <span class="s">&#39;(use 1.0 to report all associations).&#39;</span><span class="p">)</span>

    <span class="c"># Options for permutation tests</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--permute&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Perform permutation test.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--network_edgelist&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;PPI edgelist location.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--num_permuted_networks&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;The number of permuted networks to create &#39;</span>\
                             <span class="s">&#39;(only if a directory of permuted networks &#39;</span>\
                             <span class="s">&#39;is not provided).&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--permuted_networks_dir&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Directory of permuted networks.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--distance&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Flag average pairwise distance test.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--Q&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Multiplier of edge swaps for permuting networks.&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--permuted_matrices_dir&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Directory of permuted matrices.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--num_permuted_matrices&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&#39;The number of permuted matrices to create &#39;</span>\
                             <span class="s">&#39;(only if a directory of permuted matrices &#39;</span>\
                             <span class="s">&#39;is not provided).&#39;</span><span class="p">)</span>

    <span class="c"># If called from the command line, parse command line args.</span>
    <span class="k">if</span> <span class="n">input_list</span><span class="p">:</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">args</span>
 
<div class="viewcode-block" id="batch_multi_dendrix"><a class="viewcode-back" href="../module_docs/pipeline/multi_dendrix_pipeline.batch_multi_dendrix.html#multi_dendrix_pipeline.batch_multi_dendrix">[docs]</a><span class="k">def</span> <span class="nf">batch_multi_dendrix</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs Multi-Dendrix for each parameter setting on the input</span>
<span class="sd">    mutation data.</span>

<span class="sd">    **Returns:**</span>
<span class="sd">      A tuple containing the following:</span>
<span class="sd">        * **collections** (*dictionary*) - mapping of t -&gt; k -&gt; output of Multi-Dendrix</span>
<span class="sd">        * **mutation_data** (*tuple*) - mutation data tuple (see :func:`multi_dendrix.multi_dendrix` for details).</span>
<span class="sd">        * **runtime** (*float*) - total runtime (in seconds) of Multi-Dendrix on all the parameter settings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Import required modules</span>
    <span class="kn">import</span> <span class="nn">multi_dendrix</span> <span class="kn">as</span> <span class="nn">Multi</span>
    <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

    <span class="c"># Load mutation data used in each run</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">include</span> <span class="o">=</span> <span class="n">Multi</span><span class="o">.</span> <span class="n">white_and_blacklisting</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">patient_whitelist</span><span class="p">,</span>
              <span class="n">args</span><span class="o">.</span><span class="n">patient_blacklist</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">gene_whitelist</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">gene_blacklist</span><span class="p">)</span>
    <span class="n">gene2include</span><span class="p">,</span> <span class="n">sample2include</span> <span class="o">=</span> <span class="n">include</span>

    <span class="n">mutation_data</span> <span class="o">=</span> <span class="n">Multi</span><span class="o">.</span><span class="n">load_mutation_data_w_cutoff</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">mutation_matrix</span><span class="p">,</span>
                    <span class="n">sample2include</span><span class="p">,</span> <span class="n">gene2include</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">genes</span><span class="p">,</span> <span class="n">patients</span><span class="p">,</span> <span class="n">mutation2patients</span><span class="p">,</span> <span class="n">patient2mutations</span> <span class="o">=</span> <span class="n">mutation_data</span>

    <span class="c"># Run Multi-Dendrix for the range of parameters </span>
    <span class="n">ts</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">min_num_gene_sets</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">max_num_gene_sets</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">min_gene_set_size</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">max_gene_set_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">collections</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">k_max</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">]:</span>
        <span class="n">multi_params</span> <span class="o">=</span> <span class="p">[</span> <span class="n">mutation_data</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">min_gene_set_size</span><span class="p">,</span> <span class="n">k_max</span><span class="p">,</span>
                         <span class="n">args</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">lmbda</span> <span class="p">]</span>
        <span class="n">collection_w_weights</span> <span class="o">=</span> <span class="n">Multi</span><span class="o">.</span><span class="n">multi_dendrix</span><span class="p">(</span><span class="o">*</span><span class="n">multi_params</span><span class="p">,</span>
                                                   <span class="n">verbose</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">collections</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">k_max</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">collection_w_weights</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">collections</span><span class="p">,</span> <span class="n">mutation_data</span><span class="p">,</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</div>
<div class="viewcode-block" id="run_network_permutation_test"><a class="viewcode-back" href="../module_docs/pipeline/multi_dendrix_pipeline.run_network_permutation_test.html#multi_dendrix_pipeline.run_network_permutation_test">[docs]</a><span class="k">def</span> <span class="nf">run_network_permutation_test</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span> <span class="n">core_modules</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs the direct interactions or average pairwise distance test</span>
<span class="sd">    on each of the collections and the core_modules.</span>

<span class="sd">    **Returns**:</span>
<span class="sd">      * **evaluation** (*dictionary*) - a mapping of t -&gt; k -&gt; the network evaluation tuple of each collection (see :func:`network_tests.evaluate_collection` for details)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">permute_ppi_network</span> <span class="kn">import</span> <span class="n">load_network</span><span class="p">,</span> <span class="n">permute_network</span>

    <span class="c"># Load original network and generate permuted networks</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">load_network</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">network_edgelist</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">permuted_networks_dir</span><span class="p">:</span>
        <span class="n">network_files</span> <span class="o">=</span> <span class="p">[</span> <span class="n">args</span><span class="o">.</span><span class="n">permuted_networks_dir</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">fh</span>
                          <span class="k">for</span> <span class="n">fh</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">permuted_networks_dir</span><span class="p">)]</span>
        <span class="n">Hs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">load_network</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="k">for</span> <span class="n">H</span> <span class="ow">in</span> <span class="n">network_files</span> <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Hs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">permute_network</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_permuted_networks</span><span class="p">)</span> <span class="p">]</span>

    <span class="c"># Perform network test</span>
    <span class="kn">from</span> <span class="nn">network_tests</span> <span class="kn">import</span> <span class="n">evaluate_collection</span>
    <span class="n">evaluation</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">k_max</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">gene_sets</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">collections</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">k_max</span><span class="p">]</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">evaluate_collection</span><span class="p">(</span><span class="n">gene_sets</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
            <span class="c"># test_name, statistic, pval, gene_set_results = results</span>
            <span class="n">evaluation</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">k_max</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span>

    <span class="n">evaluation</span><span class="p">[</span><span class="s">&quot;core_modules&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluate_collection</span><span class="p">(</span><span class="n">core_modules</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Hs</span><span class="p">,</span>
                                                     <span class="n">args</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">evaluation</span>
</div>
<div class="viewcode-block" id="run_matrix_permutation_test"><a class="viewcode-back" href="../module_docs/pipeline/multi_dendrix_pipeline.run_matrix_permutation_test.html#multi_dendrix_pipeline.run_matrix_permutation_test">[docs]</a><span class="k">def</span> <span class="nf">run_matrix_permutation_test</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span> <span class="n">mutation_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs the direct interactions or average pairwise distance test</span>
<span class="sd">    on each of the collections and the core_modules.</span>

<span class="sd">    **Returns**:</span>
<span class="sd">      * **evaluation** (*dictionary*) - a mapping of t -&gt; k -&gt; the network evaluation tuple of each collection (see :func:`network_tests.evaluate_collection` for details)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">permute_mutation_data</span> <span class="kn">as</span> <span class="nn">Permut</span>
    <span class="kn">from</span> <span class="nn">matrix_permutation_test</span> <span class="kn">import</span> <span class="n">load_permuted_matrices</span><span class="p">,</span> <span class="n">matrix_permutation_test</span>

    <span class="c"># Load / generate networks</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">permuted_matrices_dir</span><span class="p">:</span>
        <span class="n">permuted_matrices</span> <span class="o">=</span> <span class="n">load_permuted_matrices</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">permuted_matrices_dir</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">genes</span><span class="p">,</span> <span class="n">patients</span><span class="p">,</span> <span class="n">G2T</span><span class="p">,</span> <span class="n">T2G</span> <span class="o">=</span> <span class="n">mutation_data</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">Permut</span><span class="o">.</span><span class="n">construct_mutation_graph</span><span class="p">(</span><span class="n">G2T</span><span class="p">,</span> <span class="n">T2G</span><span class="p">)</span>
        <span class="n">Hs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Permut</span><span class="o">.</span><span class="n">permute_mutation_data</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">genes</span><span class="p">,</span> <span class="n">patients</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_permuted_matrices</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">permuted_matrices</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Permut</span><span class="o">.</span><span class="n">graph_to_mutation_data</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="k">for</span> <span class="n">H</span> <span class="ow">in</span> <span class="n">Hs</span> <span class="p">]</span>

    <span class="c"># Perform network test</span>
    <span class="n">evaluation</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">k_max</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">gene_sets</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">collections</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">k_max</span><span class="p">]</span>
            <span class="n">test_args</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">),</span> <span class="n">permuted_matrices</span><span class="p">,</span>
                         <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">min_gene_set_size</span><span class="p">,</span> <span class="n">k_max</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
                         <span class="n">args</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">lmbda</span><span class="p">]</span>
            <span class="n">pval</span> <span class="o">=</span> <span class="n">matrix_permutation_test</span><span class="p">(</span><span class="o">*</span><span class="n">test_args</span><span class="p">)</span>
            <span class="n">evaluation</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">k_max</span><span class="p">]</span> <span class="o">=</span> <span class="n">pval</span>

    <span class="k">return</span> <span class="n">evaluation</span>
</div>
<span class="k">def</span> <span class="nf">permutation_tests</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span> <span class="n">core_modules</span><span class="p">,</span> <span class="n">mutation_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper function that performs both the network and matrix permutation tests</span>
<span class="sd">    on the input collections.&quot;&quot;&quot;</span>
    <span class="n">matrix_results</span> <span class="o">=</span> <span class="n">run_matrix_permutation_test</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span>
                                                <span class="n">mutation_data</span><span class="p">)</span>
    <span class="n">network_results</span> <span class="o">=</span> <span class="n">run_network_permutation_test</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span> 
                                                   <span class="n">core_modules</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">network_results</span><span class="p">,</span> <span class="n">matrix_results</span>

<span class="k">def</span> <span class="nf">flatten_collections</span><span class="p">(</span><span class="n">collections</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes a dictionary of parameter settings to Multi-Dendrix results (as output by </span>
<span class="sd">    :func:`batch_multi_dendrix`), and flattens the map into a list of collections.&quot;&quot;&quot;</span>
    <span class="n">all_collections</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">k_max</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">collection</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">collections</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">k_max</span><span class="p">]</span>
            <span class="n">all_collections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">collection</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">all_collections</span>

<div class="viewcode-block" id="run"><a class="viewcode-back" href="../module_docs/pipeline/multi_dendrix_pipeline.run.html#multi_dendrix_pipeline.run">[docs]</a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs the whole Multi-Dendrix pipeline for the given command-line arguments.&quot;&quot;&quot;</span>
    <span class="c"># Run Multi-Dendrix for all parameter settings </span>
    <span class="n">collections</span><span class="p">,</span> <span class="n">mutation_data</span><span class="p">,</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">batch_multi_dendrix</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    
    <span class="c"># Extract the stable modules</span>
    <span class="kn">import</span> <span class="nn">core_modules</span> <span class="kn">as</span> <span class="nn">Core</span>
    <span class="n">all_collections</span> <span class="o">=</span> <span class="n">flatten_collections</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span>
    <span class="n">core</span> <span class="o">=</span> <span class="n">Core</span><span class="o">.</span><span class="n">extract_core_modules</span><span class="p">(</span><span class="n">all_collections</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">stability_threshold</span><span class="p">)</span>
    <span class="n">core_modules</span><span class="p">,</span> <span class="n">module_graph</span> <span class="o">=</span> <span class="n">core</span>

    <span class="c"># Perform the permutation test (if required)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">permute</span><span class="p">:</span>
        <span class="n">evaluation</span>  <span class="o">=</span> <span class="n">permutation_tests</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span> <span class="n">core_modules</span><span class="p">,</span> 
                                        <span class="n">mutation_data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">evaluation</span>  <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="c"># Perform subtype analysis (if required)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">subtypes</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">patient_whitelist</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">subtype_specific_genes</span> <span class="kn">import</span> <span class="n">subtype_analysis</span><span class="p">,</span> <span class="n">create_subtype_tbl</span>
        <span class="n">gene2specificity</span> <span class="o">=</span> <span class="n">subtype_analysis</span><span class="p">(</span><span class="n">mutation_data</span><span class="p">,</span>
                                            <span class="n">args</span><span class="o">.</span><span class="n">patient_whitelist</span><span class="p">,</span>
                                            <span class="n">args</span><span class="o">.</span><span class="n">subtype_sig_threshold</span><span class="p">)</span>
        <span class="n">subtype_tbl</span> <span class="o">=</span> <span class="n">create_subtype_tbl</span><span class="p">(</span><span class="n">gene2specificity</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">gene2specificity</span><span class="p">,</span> <span class="n">subtype_tbl</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">subtypes</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;No patient whitelist (w/ (sub)types) provided, &#39;</span>\
                  <span class="s">&#39;skipping (sub)type analysis.&#39;</span>

    <span class="c"># Create tables used for text and/or html output</span>
    <span class="n">collection_tbls</span> <span class="o">=</span> <span class="n">create_collection_tbls</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span>
                                               <span class="n">core_modules</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">)</span>
    <span class="n">params_tbl</span> <span class="o">=</span> <span class="n">create_params_tbl</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">mutation_data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">permute</span><span class="p">:</span>   
        <span class="n">network_tbl</span> <span class="o">=</span>  <span class="n">create_network_results_tbl</span><span class="p">(</span><span class="n">evaluation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">matrix_tbl</span> <span class="o">=</span> <span class="n">create_matrix_results_tbl</span><span class="p">(</span><span class="n">evaluation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">network_tbl</span><span class="p">,</span> <span class="n">matrix_tbl</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="c"># output results to text and html</span>
    <span class="n">text_output_args</span> <span class="o">=</span> <span class="p">[</span> <span class="n">args</span><span class="p">,</span> <span class="n">collection_tbls</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">params_tbl</span><span class="p">,</span>
                         <span class="n">network_tbl</span><span class="p">,</span> <span class="n">matrix_tbl</span><span class="p">,</span> <span class="n">subtype_tbl</span> <span class="p">]</span>
    <span class="n">output_to_text</span><span class="p">(</span><span class="o">*</span><span class="n">text_output_args</span><span class="p">)</span>

    <span class="n">output_to_html</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">module_graph</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">,</span>
                   <span class="n">params_tbl</span><span class="p">,</span> <span class="n">subtype_tbl</span><span class="p">,</span> <span class="n">gene2specificity</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span> <span class="n">run</span><span class="p">(</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../pipeline.html">pipeline</a>|&nbsp;</li>
        <li><a href="../contents.html">contents</a>|&nbsp;</li>
        <li><a href="../examples.html">examples</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Max Leiserson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>